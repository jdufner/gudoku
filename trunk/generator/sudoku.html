<html>
  <head>
    <title>Sudoku 2010-02</title>
    <style type="text/css">
<!--
* {
  font-family: Verdana, Arial, Helvetica, sans-serif;
}
td.fixed {
  font-size: 15px;
  font-weight: bold;
  text-align: center;
  vertical-align: middle;
  border: #999999 solid 1px;
  width: 40px;
  min-width: 40px;
  max-width: 40px;
  height: 40px;
  min-height: 40px;
  max-height: 40px;
  margin: 0px;
  padding: 0px;
  cursor: default;
}
td.candidate {
  font-size: 9px;
  text-align: center;
  vertical-align: middle;
  width: 13px;
  min-width: 13px;
  max-width: 13px;
  height: 13px;
  min-height: 13px;
  max-height: 13px;
  cursor: default;
}
td.block1, td.block3, td.block5, td.block7, td.block9 {
  background-color: #FFFFFF;
}
td.block2, td.block4, td.block6, td.block8 {
  background-color: #CCCCCC;
}
td.original {
  color: #0000ff;
}
td.conflict {
  border: #ff0000 solid 1px;
}
td.highlight1, td.highlight2 {
  background-color: #ffff00;
}
div.candidateButtonOff {
  margin: 2px;
  padding: 2px;
  border: 2px #999999 outset;
  background-color: #ffff00;
  cursor: default;
}
div.candidateButtonOn {
  margin: 2px;
  padding: 2px;
  border: 2px #999999 inset;
  background-color: #cccc00;
  cursor: default;
}
-->
    </style>
  </head>
  <body>
    <h1>Sudoku 2010-02</h1>
    <div id="sudoku" style="float:left"></div>
    <div id="candidateButtons" style="float:left; margin-left:10px;"></div>
    <div id="buttons" style="clear:both; margin-top:10px;">
      <select id="quests" name="quests" size="1">
        <option value=".......8......9.3...7.4.......5..6..7...2..1.268........17....4..3....27..9..6...">26740 leicht</option>
        <option value="2......3....8...5.....91..891..........3..9...8...62....3..2.8...56...4.....4....">27084 leicht</option>
        <option value="...4.....2....7.16.9..8...2.6....9..1.7...52..48.....14.....7.9.8...........2..38">27188 sehr leicht</option>
        <option value="..1.4.....9.....6...7....35..8.7...2.4651....9........3..7.....18..6.4.......5...">27701 mittel</option>
        <option value="1..7......8..6...43..1....5..6....9......24..9.....37..5.4.....81..59..2.........">28072 mittel</option>
        <option value="....6.2..8..7.....5...2.7..4......53...89...7......1....9....32...3...8...6..1...">28502 sehr schwer</option>
        <option value=".9.....3..82...61........2...89........7.8..163.........5.....9...17..4....32...5">28670 mittel</option>
        <option value=".718...2.5..2...34.....4.....8...1.6..4...5.....3.7.......6....8...41....9.......">28702 leicht</option>
        <option value="9..5...3...78...........186.3..8..9..61..4....8...2....9......1...3.......4..6..2">29687 mittel</option>
        <option value="1....9...2....3..1..7....5..1...63.......8.9...6.1...........7478......9....41.2.">30658 mittel</option>
        <option value=".81..2.......8.3.....1..9.43.....2.......9...2.....74....37..9.......1...26..4...">31415 leicht</option>
        <option value=".5...981..9.........4...5......2..9....483.2..43............7...69.3....3.5..1.6.">33107 schwer</option>
        <option value="2..5...6.9..1...........1...5....7.3..4..2..5....9...1...47....1..........2..349.">33297 leicht</option>
        <option value="....5.............23...9.58..6..1....1...362.7.4...3.....74..........1...528.....">34502 leicht</option>
        <option value="3...8.....8....3...5...9..14.9.....3.........8..5.37......61...6.....54.....9..8.">35629 sehr schwer</option>
        <option value="5.......4.....7....8..6..2.8.........921.......5.4.68..2..8.1...4...9..7.......6.">36299 sehr schwer</option>
        <option value="....91.5......4..9.16..8..4...6......89.4......3.85.9........3.4.......77.....81.">36327 schwer</option>
        <option value="...6...4...71..38.....5......3.....21...2......4..75...75.1...34...7.2.....3....1">37655 schwer</option>
        <option value="..2..1...1..49....5......8....9...4......2..1....5...9..51.73...84......2.....8..">39234 mittel</option>
        <option value="...23.......9...7...4...9.........5...9.....27...54...3.58.......2.9.4...6....2.3">40215 sehr schwer</option>
        <option value="..76.....3......5.....94...........1..1..9.2....3.6..585..7..3..4...5..27..42....">40364 schwer</option>
        <option value="5..3.1...6...8......4.5...6..5....3..1.....9.7......5.37...2...9.2..6.......478..">41531 sehr leicht</option>
        <option value="3.2..........7.........8.4.1......3.6..35...2..8..4....916.......4.2.6.7.......8.">42254 sehr schwer</option>
        <option value=".5..3...8..6....4...3..........56....8.........41.3.6.5..69.....9..8.........74.3">42798 sehr schwer</option>
        <option value=".59.....3...2.6.....4.......3......168...9...4.....89......84.681....5.....53...2">45850 sehr leicht</option>
        <option value=".7.9.6.2......3.....9...547.....17...1........6.....8.......17.4..5..3.99..3....2">48013 sehr leicht</option>
        <option value=".35...6....4..3........2.8.7...3.8.4...8........5...262.....1.34....6....68......">48383 schwer</option>
        <option value="9.....4..7...8.......16...5..1.4..2.5...2....83...57.....3............6.17.6..9.3">48975 sehr leicht</option>
        <option value="..1..9.........9.28.......6....3..5413..6......42.....9..8.......5..4..9.7....2.8">49908 schwer</option>
        <option value="...26.9.78.........5..8...4...32..1..........1.8..6.49....18......7...2...1...35.">53933 sehr leicht</option>
      </select>
      <input type="button" value="Laden" onclick="copyAndLoadSudoku()"/><br/>
      <input id="sudokuAsString" type="text" value="1382.5.7.2.783415.....1723838.5....1....2.58..5...8....2..8.3..913.5.84.876.4.9.5"/>
      <input type="button" value="Laden" onclick="loadSudoku()"/><br/>
      <input type="button" value="Kandidaten entfernen" onclick="removeAllCandidates()"/><input type="button" value="Reset" onclick="resetAllCandidates()"/><input type="button" value="Leeren" onclick="emptyCandidates()"/>
    </div>
  </body>
  <script language="javascript">
<!--
var size = 9;
var subSize = 3;
var original;

function main() {
  buildBoard();
  buildCandidateButtons();
}

function addStyle(style, newStyle) {
  var erg = style.indexOf(newStyle);
  if (erg >= 0) {
    return style;
  } else {
    return style + " " + newStyle;
  }
}

function removeStyle(style, oldStyle) {
  var erg = style.indexOf(" " + oldStyle);
  if (erg >= 0) {
    return style.substr(0, erg);
  } else {
    return style;
  }
}

function getCell(cellId) {
  return document.getElementById(cellId);
}

function getCellId(cellNumber) {
  return "cell" + cellNumber;
}

function getCandidate(cellNumber, c) {
  return document.getElementById(getCandidateId(getCellId(cellNumber), c));
}

function getCandidateId(cellId, c) {
  return cellId + "candidate" + c;
}

function getColumnNumber(cellNumber) {
  column = cellNumber % size;
  if (column == 0) {
    return size;
  }
  return column;
}

function getBlockNumber(cellNumber) {
  row = getRowNumber(cellNumber);
  column = getColumnNumber(cellNumber);
  return Math.floor((row - 1)/ subSize) * subSize + Math.floor((column - 1)/ subSize) + 1;
}

function getFixedValue(cellNumber) {
  if (isCellFixed(cellNumber)) {
    return getValue(getCell(getCellId(cellNumber)));
  }
  return null;
}

function getRowNumber(cellNumber) {
  return Math.floor((cellNumber - 1)/ size) + 1;
}

function getValue(node) {
  return parseInt(node.firstChild.data);
}

function isCellFixed(cellNumber) {
  if (getCell(getCellId(cellNumber)).firstChild.nodeType == 3) {
    return true;
  }
  return false;
}

function buildBoard() {
  var boardTable = document.createElement("table");
  boardTable.id = "board";
  boardTable.border = "0";
  boardTable.cellPadding = "0";
  boardTable.cellSpacing = "0";
  document.getElementById("sudoku").appendChild(boardTable);
  var row = null;
  for (var i = 1; i <= size * size; i++) {
    if (i % size == 1) {
      var row = document.createElement("tr");
      row.id = "row" + (Math.floor(i / size) + 1);
      boardTable.appendChild(row);
    }
    var cell = document.createElement("td");
    cell.id = getCellId(i);
    cell.className = "fixed block" + getBlockNumber(i);
    row.appendChild(cell);
    var cellText = document.createTextNode(i);
    cell.appendChild(cellText);
  }
}

function buildCandidates(cellId) {
  cell = getCell(cellId);
  cell.className = removeStyle(cell.className, "conflict")
  cell.onmouseover = null;
  cell.onmouseout = null;
  cell.onclick = null;
  cell.ondblclick = null;
  candidatesTable = document.createElement("table");
  candidatesTable.id = cellId + "candidate";
  candidatesTable.border = "0"
  candidatesTable.cellPadding = "0";
  candidatesTable.cellSpacing = "0";
  var candidatesRow = null;
  for (var i = 1; i <= size; i++) {
    if (i % subSize == 1) {
      candidatesRow = document.createElement("tr");
      candidatesRow.id = cellId + "row" + (Math.floor(i / subSize) + 1);
      candidatesTable.appendChild(candidatesRow);
    }
    candidatesCell = document.createElement("td");
    candidatesCell.id = getCandidateId(cellId, i);
    candidatesCell.className = "candidate";
    candidatesCell.onmouseover = enterCandidate;
    candidatesCell.onmouseout = exitCandidate;
    candidatesCell.onclick = removeCandidate;
    candidatesCell.ondblclick = promoteCandidate;
    candidatesRow.appendChild(candidatesCell);
    cellText = document.createTextNode(i);
    candidatesCell.appendChild(cellText);
  }
  cell.replaceChild(candidatesTable, cell.firstChild);
}

function buildFixed(cellNumber, value) {
  cell = getCell(getCellId(cellNumber));
  cell.onmouseover = enterFixed;
  cell.onmouseout = exitFixed;
  if (isInOriginal(cellNumber)) {
    cell.className = addStyle(cell.className, "original");
  } else {
    cell.className = removeStyle(cell.className, "original");
  }
  cellText = document.createTextNode(value);
  cell.replaceChild(cellText, cell.firstChild);
}

function loadSudoku() {
  if (document.getElementById("sudokuAsString").value.match(/[0-9\.]{81}/)) {
   original = document.getElementById("sudokuAsString").value;
   for (var i = 1; i <= size * size; i++) {
     value = original.substr(i - 1, 1);
     if (value == ".") {
       buildCandidates(getCellId(i));
     } else {
       buildFixed(i, value);
     }
   }
  } else {
    alert("Sudoku ist ungültig!");
  }
}

function removeAllCandidates() {
  for (var i = 1; i <= size * size; i++) {
    if (isCellFixed(i)) {
      // Nix machen!
    } else {
      // Fixed aus Zeile, Spalte und Block sammeln
      removeCandidates(i);
    }
  }
}

function collectFixed(cellNumber) {
  var fixed = new Array();
  for (var i = 1; i <= size; i++) {
    fixed[i] = false;
  }
  for (var i = 1; i <= size * size; i++) {
    if (getRowNumber(i) == getRowNumber(cellNumber)) {
      if (isCellFixed(i)) {
        fixed[getFixedValue(i)] = true;
      }
    }
    if (getColumnNumber(i) == getColumnNumber(cellNumber)) {
      if (isCellFixed(i)) {
        fixed[getFixedValue(i)] = true;
      }
    }
    if (getBlockNumber(i) == getBlockNumber(cellNumber)) {
      if (isCellFixed(i)) {
        fixed[getFixedValue(i)] = true;
      }
    }
  }
  return fixed;
}

function removeCandidates(cellNumber) {
  var fixed = collectFixed(cellNumber);
  for (var i = 1; i <= size; i++) {
    if (fixed[i]) {
      var cellId = getCellId(cellNumber);
      var candidateId = getCandidateId(cellId, i);
      removeCandidateDo(candidateId);
    }
  }
}

function conflictsCandidate(cellNumber, c) {
  return collectFixed(cellNumber)[c];
}

function enterFixed() {
  this.className = addStyle(this.className, "highlight1");
}

function exitFixed() {
  this.className = removeStyle(this.className, "highlight1");
}

function enterCandidate() {
  this.className = addStyle(this.className, "highlight1");
}

function exitCandidate() {
  this.className = removeStyle(this.className, "highlight1");
}

function removeCandidateDo(candidateId) {
  var candidate = document.getElementById(candidateId);
  if (candidate.firstChild == null || candidate.firstChild.data.length <= 0) {
    return;
  }
  candidate.className = removeStyle(candidate.className, "highlight1");
  candidate.className = removeStyle(candidate.className, "highlight2");
  candidate.onmouseover = null;
  candidate.onmouseout = null;
  //candidate.onclick = null;
  //candidate.ondblclick = null;
  candidate.removeChild(candidate.firstChild);
  //var step = null;
  //if (window.location.hash.match(/\d+/g)){
  //  step = parseInt(window.location.hash.match(/\d+/g));
  //} else {
  //  step = 0;
  //}
  //step = step + 1;
  //window.location.hash="" + step;
}

function createCandidateDo(candidateId) {
  var candidate = document.getElementById(candidateId);
  candidate.className = "candidate";
  candidate.onmouseover = enterCandidate;
  candidate.onmouseout = exitCandidate;
  //candidate.onclick = removeCandidate;
  //candidate.ondblclick = promoteCandidate;
  var re = candidateId.match(/candidate(\d+)/g);
  var value = RegExp.$1;
  if (isCandidateButtonOn(value)) {
    candidate.className = addStyle(candidate.className, "highlight2");
  }
  candidateText = document.createTextNode(value);
  candidate.appendChild(candidateText);
}

function createOrRemoveCandidateDo(candidateId) {
  var candidate = document.getElementById(candidateId);
  if (candidate.firstChild != null && candidate.firstChild.nodeType == 3) {
    removeCandidateDo(candidateId);
  } else {
    createCandidateDo(candidateId);
  }
}

function promoteCandidateDo(candidateId) {
  candidate = document.getElementById(candidateId);
  var re = new RegExp("cell(\\d+)candidate(\\d+)","i");
  if (re.test(candidateId)) {
    var cellNumber = parseInt(RegExp.$1);
    var candidateNumber = parseInt(RegExp.$2);
    var cellId = getCellId(cellNumber)
    var cell = document.getElementById(cellId);
    if (conflictsCandidate(cellNumber, candidateNumber)) {
      cell.className = addStyle(cell.className, "conflict");
    }
    cell.replaceChild(document.createTextNode(candidateNumber), cell.firstChild);
    cell.onclick = resetFixed;
  }
}

var dblclick = false;

function removeCandidate() {
  var candidateId = this.id;
  setTimeout(function() {
    if (dblclick == true) {
      return;
    }
    createOrRemoveCandidateDo(candidateId);
  }, 250);
}

function promoteCandidate() {
  var candidateId = this.id;
  dblclick = true;
  promoteCandidateDo(candidateId);
  setTimeout(function() {
    dblclick = false;
  }, 250);
}

function buildCandidateButtons() {
  var candidateButtons = document.getElementById("candidateButtons");
  for (var i = 1; i <= size; i++) {
    var candidateButton = document.createElement("div");
    candidateButton.id = "candidateButton" + i;
    candidateButton.className = "candidateButtonOff";
    candidateButton.onclick = highlightCandidates;
    candidateButtons.appendChild(candidateButton);
    candidateButton.appendChild(document.createTextNode(i));
  }
}

function highlightCandidates() {
  var candidate = parseInt(this.id.match(/\d+/g)[0]);
  if (this.className == "candidateButtonOff") {
    this.className = "candidateButtonOn";
    for (var i = 1; i <= size * size; i++) {
      if (!isCellFixed(i)) {
        for (var k = 1; k <= size; k++) {
          var candidateNode = getCandidate(i, k);
          if (candidateNode.childNodes.length > 0 && candidateNode.firstChild.data.length > 0) {
            if (k == candidate) {
              candidateNode.className = addStyle(candidateNode.className, "highlight2");
            }
          }
        }
      }
    }
  } else {
    this.className = "candidateButtonOff";
    for (var i = 1; i <= size * size; i++) {
      if (!isCellFixed(i)) {
        for (var k = 1; k <= size; k++) {
          var candidateNode = getCandidate(i, k);
          if (candidateNode.childNodes.length > 0 && candidateNode.firstChild.data.length > 0) {
            if (k == candidate) {
              candidateNode.className = removeStyle(candidateNode.className, "highlight2");
            }
          }
        }
      }
    }
  }
}

function isCandidateButtonOn(value) {
  for (var i = 1; i <= size; i++) {
    var candidateButton = document.getElementById("candidateButton" + i);
    if (candidateButton.className.match(/candidateButtonOn/g)) {
      return true;
    }
  }
  return false;
}

function resetFixed() {
  if (isInOriginal(this.id.match(/\d+/g)[0])) {
    // Nix machen
  } else {
    // Reset
    buildCandidates(this.id);
  }
}

function isInOriginal(cellNumber) {
  var originalChar = original.substr(cellNumber - 1, 1);
  if (originalChar.match(/\d+/)) {
    return true;
  }
  return false;
}

function resetAllCandidates() {
  for (var i = 1; i <= size * size; i++) {
    if (!isCellFixed(i)) {
      buildCandidates(getCellId(i));
    }
  }
}

function emptyCandidates() {
  for (var i = 1; i <= size * size; i++) {
    if (!isCellFixed(i)) {
      for (var k = 1; k <= size; k++) {
        removeCandidateDo(getCandidateId(getCellId(i), k));
      }
    }
  }
}

function copyAndLoadSudoku() {
  //document.getElementById("sudokuAsString").value = document.getElementById("quests");
  var quests = document.getElementById("quests")
  var quest = document.getElementById("quests").value;
  document.getElementById("sudokuAsString").value = document.getElementById("quests").value;
  loadSudoku();
}

main();

-->
  </script>
</html>
